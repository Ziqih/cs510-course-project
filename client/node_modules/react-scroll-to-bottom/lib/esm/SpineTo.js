/* eslint no-magic-numbers: ["error", { "ignore": [0, 1, 1.5, 5] }] */
import { useCallback, useLayoutEffect, useRef } from 'react';
import PropTypes from 'prop-types';

function squareStepper(current, to) {
  var sign = Math.sign(to - current);
  var step = Math.sqrt(Math.abs(to - current));
  var next = current + step * sign;

  if (sign > 0) {
    return Math.min(to, next);
  }

  return Math.max(to, next);
}

function step(from, to, stepper, index) {
  var next = from;

  for (var i = 0; i < index; i++) {
    next = stepper(next, to);
  }

  return next;
}

var SpineTo = function SpineTo(_ref) {
  var name = _ref.name,
      onEnd = _ref.onEnd,
      target = _ref.target,
      value = _ref.value;
  var animator = useRef();
  var animate = useCallback(function (name, from, to, index) {
    var start = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : Date.now();

    if (to === '100%' || typeof to === 'number') {
      cancelAnimationFrame(animator.current);
      animator.current = requestAnimationFrame(function () {
        if (target) {
          var toNumber = to === '100%' ? target.scrollHeight - target.offsetHeight : to;
          var nextValue = step(from, toNumber, squareStepper, (Date.now() - start) / 5);

          if (Math.abs(toNumber - nextValue) < 1.5) {
            nextValue = toNumber;
          }

          target[name] = nextValue;

          if (toNumber === nextValue) {
            onEnd && onEnd(true);
          } else {
            animate(name, from, to, index + 1, start);
          }
        }
      });
    }
  }, [animator, onEnd, target]);
  var handleCancelAnimation = useCallback(function () {
    cancelAnimationFrame(animator.current);
    onEnd && onEnd(false);
  }, [onEnd]);
  useLayoutEffect(function () {
    animate(name, target[name], value, 1);

    if (target) {
      target.addEventListener('pointerdown', handleCancelAnimation, {
        passive: true
      });
      target.addEventListener('wheel', handleCancelAnimation, {
        passive: true
      });
      return function () {
        target.removeEventListener('pointerdown', handleCancelAnimation);
        target.removeEventListener('wheel', handleCancelAnimation);
        cancelAnimationFrame(animator.current);
      };
    }

    return function () {
      return cancelAnimationFrame(animator.current);
    };
  }, [animate, animator, handleCancelAnimation, name, target, value]);
  return false;
};

SpineTo.propTypes = {
  name: PropTypes.string.isRequired,
  onEnd: PropTypes.func,
  target: PropTypes.any.isRequired,
  value: PropTypes.oneOfType([PropTypes.number, PropTypes.oneOf(['100%'])]).isRequired
};
export default SpineTo;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TcGluZVRvLmpzIl0sIm5hbWVzIjpbInVzZUNhbGxiYWNrIiwidXNlTGF5b3V0RWZmZWN0IiwidXNlUmVmIiwiUHJvcFR5cGVzIiwic3F1YXJlU3RlcHBlciIsImN1cnJlbnQiLCJ0byIsInNpZ24iLCJNYXRoIiwic3RlcCIsInNxcnQiLCJhYnMiLCJuZXh0IiwibWluIiwibWF4IiwiZnJvbSIsInN0ZXBwZXIiLCJpbmRleCIsImkiLCJTcGluZVRvIiwibmFtZSIsIm9uRW5kIiwidGFyZ2V0IiwidmFsdWUiLCJhbmltYXRvciIsImFuaW1hdGUiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInRvTnVtYmVyIiwic2Nyb2xsSGVpZ2h0Iiwib2Zmc2V0SGVpZ2h0IiwibmV4dFZhbHVlIiwiaGFuZGxlQ2FuY2VsQW5pbWF0aW9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsInBhc3NpdmUiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwicHJvcFR5cGVzIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsImZ1bmMiLCJhbnkiLCJvbmVPZlR5cGUiLCJudW1iZXIiLCJvbmVPZiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFFQSxTQUFTQSxXQUFULEVBQXNCQyxlQUF0QixFQUF1Q0MsTUFBdkMsUUFBcUQsT0FBckQ7QUFDQSxPQUFPQyxTQUFQLE1BQXNCLFlBQXRCOztBQUVBLFNBQVNDLGFBQVQsQ0FBdUJDLE9BQXZCLEVBQWdDQyxFQUFoQyxFQUFvQztBQUNsQyxNQUFNQyxJQUFJLEdBQUdDLElBQUksQ0FBQ0QsSUFBTCxDQUFVRCxFQUFFLEdBQUdELE9BQWYsQ0FBYjtBQUNBLE1BQU1JLElBQUksR0FBR0QsSUFBSSxDQUFDRSxJQUFMLENBQVVGLElBQUksQ0FBQ0csR0FBTCxDQUFTTCxFQUFFLEdBQUdELE9BQWQsQ0FBVixDQUFiO0FBQ0EsTUFBTU8sSUFBSSxHQUFHUCxPQUFPLEdBQUdJLElB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RXBCLFNBQVMsQ0FBQ3lDLFNBQVYsQ0FBb0IsQ0FBQ3pDLFNBQVMsQ0FBQzBDLE1BQVgsRUFBbUIxQyxTQUFTLENBQUMyQyxLQUFWLENBQWdCLENBQUMsTUFBRCxDQUFoQixDQUFuQixDQUFwQixFQUFtRUw7QUFKeEQsQ0FBcEI7QUFPQSxlQUFldEIsT0FBZiIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCBuby1tYWdpYy1udW1iZXJzOiBbXCJlcnJvclwiLCB7IFwiaWdub3JlXCI6IFswLCAxLCAxLjUsIDVdIH1dICovXG5cbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VMYXlvdXRFZmZlY3QsIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5cbmZ1bmN0aW9uIHNxdWFyZVN0ZXBwZXIoY3VycmVudCwgdG8pIHtcbiAgY29uc3Qgc2lnbiA9IE1hdGguc2lnbih0byAtIGN1cnJlbnQpO1xuICBjb25zdCBzdGVwID0gTWF0aC5zcXJ0KE1hdGguYWJzKHRvIC0gY3VycmVudCkpO1xuICBjb25zdCBuZXh0ID0gY3VycmVudCArIHN0ZXAgKiBzaWduO1xuXG4gIGlmIChzaWduID4gMCkge1xuICAgIHJldHVybiBNYXRoLm1pbih0bywgbmV4dCk7XG4gIH1cblxuICByZXR1cm4gTWF0aC5tYXgodG8sIG5leHQpO1xufVxuXG5mdW5jdGlvbiBzdGVwKGZyb20sIHRvLCBzdGVwcGVyLCBpbmRleCkge1xuICBsZXQgbmV4dCA9IGZyb207XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleDsgaSsrKSB7XG4gICAgbmV4dCA9IHN0ZXBwZXIobmV4dCwgdG8pO1xuICB9XG5cbiAgcmV0dXJuIG5leHQ7XG59XG5cbmNvbnN0IFNwaW5lVG8gPSAoeyBuYW1lLCBvbkVuZCwgdGFyZ2V0LCB2YWx1ZSB9KSA9PiB7XG4gIGNvbnN0IGFuaW1hdG9yID0gdXNlUmVmKCk7XG5cbiAgY29uc3QgYW5pbWF0ZSA9IHVzZUNhbGxiYWNrKFxuICAgIChuYW1lLCBmcm9tLCB0bywgaW5kZXgsIHN0YXJ0ID0gRGF0ZS5ub3coKSkgPT4ge1xuICAgICAgaWYgKHRvID09PSAnMTAwJScgfHwgdHlwZW9mIHRvID09PSAnbnVtYmVyJykge1xuICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShhbmltYXRvci5jdXJyZW50KTtcblxuICAgICAgICBhbmltYXRvci5jdXJyZW50ID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgICAgICBjb25zdCB0b051bWJlciA9IHRvID09PSAnMTAwJScgPyB0YXJnZXQuc2Nyb2xsSGVpZ2h0IC0gdGFyZ2V0Lm9mZnNldEhlaWdodCA6IHRvO1xuICAgICAgICAgICAgbGV0IG5leHRWYWx1ZSA9IHN0ZXAoZnJvbSwgdG9OdW1iZXIsIHNxdWFyZVN0ZXBwZXIsIChEYXRlLm5vdygpIC0gc3RhcnQpIC8gNSk7XG5cbiAgICAgICAgICAgIGlmIChNYXRoLmFicyh0b051bWJlciAtIG5leHRWYWx1ZSkgPCAxLjUpIHtcbiAgICAgICAgICAgICAgbmV4dFZhbHVlID0gdG9OdW1iZXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRhcmdldFtuYW1lXSA9IG5leHRWYWx1ZTtcblxuICAgICAgICAgICAgaWYgKHRvTnVtYmVyID09PSBuZXh0VmFsdWUpIHtcbiAgICAgICAgICAgICAgb25FbmQgJiYgb25FbmQodHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBhbmltYXRlKG5hbWUsIGZyb20sIHRvLCBpbmRleCArIDEsIHN0YXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgW2FuaW1hdG9yLCBvbkVuZCwgdGFyZ2V0XVxuICApO1xuXG4gIGNvbnN0IGhhbmRsZUNhbmNlbEFuaW1hdGlvbiA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBjYW5jZWxBbmltYXRpb25GcmFtZShhbmltYXRvci5jdXJyZW50KTtcbiAgICBvbkVuZCAmJiBvbkVuZChmYWxzZSk7XG4gIH0sIFtvbkVuZF0pO1xuXG4gIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgYW5pbWF0ZShuYW1lLCB0YXJnZXRbbmFtZV0sIHZhbHVlLCAxKTtcblxuICAgIGlmICh0YXJnZXQpIHtcbiAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsIGhhbmRsZUNhbmNlbEFuaW1hdGlvbiwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgaGFuZGxlQ2FuY2VsQW5pbWF0aW9uLCB7IHBhc3NpdmU6IHRydWUgfSk7XG5cbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsIGhhbmRsZUNhbmNlbEFuaW1hdGlvbik7XG4gICAgICAgIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCd3aGVlbCcsIGhhbmRsZUNhbmNlbEFuaW1hdGlvbik7XG4gICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdG9yLmN1cnJlbnQpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gKCkgPT4gY2FuY2VsQW5pbWF0aW9uRnJhbWUoYW5pbWF0b3IuY3VycmVudCk7XG4gIH0sIFthbmltYXRlLCBhbmltYXRvciwgaGFuZGxlQ2FuY2VsQW5pbWF0aW9uLCBuYW1lLCB0YXJnZXQsIHZhbHVlXSk7XG5cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuU3BpbmVUby5wcm9wVHlwZXMgPSB7XG4gIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgb25FbmQ6IFByb3BUeXBlcy5mdW5jLFxuICB0YXJnZXQ6IFByb3BUeXBlcy5hbnkuaXNSZXF1aXJlZCxcbiAgdmFsdWU6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5udW1iZXIsIFByb3BUeXBlcy5vbmVPZihbJzEwMCUnXSldKS5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnQgZGVmYXVsdCBTcGluZVRvO1xuIl19